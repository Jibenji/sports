<div class="map-box">
  <div id="map";">
    <% content_for(:after_js) do %>
      <%= javascript_tag do %>
        $(document).ready(function() {
          handler = Gmaps.build('Google', { markers: { maxRandomDistance: null } });
          handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){

          markers = handler.addMarkers(<%=raw @hash.to_json %>);

          _.each(<%=raw @hash.to_json %>, function(json, index){
          json.marker = markers[index];
          $(".result-card-" + json.id).on('mouseover', function(e) {
            console.log(e)
            handler.getMap().setZoom(14);
            json.marker.setMap(handler.getMap()); //because clusterer removes map property from marker
            json.marker.panTo();
            google.maps.event.trigger(json.marker.getServiceObject(), 'click');
          });
          });
          handler.bounds.extendWith(markers);
          handler.fitMapToBounds();
          handler.getMap().setZoom(14);
          });
        });
      <% end %>
    <% end %>
  </div>
</div>
